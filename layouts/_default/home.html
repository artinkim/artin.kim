{{ define "main" }}
<div class="home-container animate">
    <!-- Title Section at Top -->
    <div class="title-section">
        <h1 class="primary-anim">{{ site.Title }}</h1>
        {{ with site.Menus.main }}
        <nav class="menu inline animate">
            {{ range . }}
            <div class="menu-item">
                <a class="inactive nav-link-text {{ .Name }}" href="{{ .URL }}" data-text="{{ .Name }}"></a>
            </div>
            {{ end }}
        </nav>
        {{ end }}
    </div>

    <!-- Two Column Layout Below -->
    <div class="two-column-layout">
        <!-- Image moved outside and before the sections, positioned absolutely -->
        <img src="/img/artin_headshot.jpg" alt="Profile picture" class="profile-image-absolute">

        <!-- About Me Section -->
        <section class="about-section">
            <h2>About Me</h2>
            <p>
            I'm a software engineer and researcher interested in computer graphics,
            programming languages, and systems. I'm currently working on real-time
            rendering techniques and compiler optimizations. In my free time, I enjoy
            contributing to open source projects.
            </p>
        </section>
        
        <!-- Highlights Section -->
        <section class="highlights-section">
            <h2>Highlights</h2>
            <div class="highlights-grid">
                <!-- Projects Highlight -->
                <div class="highlight-card">
                    <div>
                        <h3>Project: Real-Time Ray Tracer</h3>
                        <p>An ongoing project exploring real-time path tracing techniques using the Vulkan API and GLSL compute shaders.</p>
                    </div>
                    <a href="/projects/real-time-ray-tracer/" class="highlight-link">View Project →</a>
                </div>
                
                <!-- Highlighted Blog Post -->
                <div class="highlight-card">
                    <div>
                        <h3>Blog: Optimizing Shader Performance</h3>
                        <p>A deep dive into common pitfalls and effective strategies for writing high-performance GLSL shaders for modern GPUs.</p>
                    </div>
                    <a href="/blog/optimizing-shader-performance/" class="highlight-link">Read Post →</a>
                </div>
                
                <!-- Highlighted Publication -->
                <div class="highlight-card">
                    <div>
                        <h3>Publication: Novel GI Technique</h3>
                        <p>Details on a new method for approximating global illumination in dynamic scenes, published in ACM Transactions on Graphics.</p>
                    </div>
                    <a href="/publications/novel-gi-technique/" class="highlight-link">See Publication →</a>
                </div>
                
                <!-- Highlighted Video -->
                <div class="highlight-card">
                    <div>
                        <h3>Video: Intro to Compute Shaders</h3>
                        <p>A beginner-friendly tutorial explaining the fundamentals of GPU compute shaders and how to leverage them for general-purpose tasks.</p>
                    </div>
                    <a href="/videos/intro-to-compute-shaders/" class="highlight-link">Watch Video →</a>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const homeContainer = document.querySelector('.home-container');
    const titleSection = document.querySelector('.title-section');
    const titleH1 = document.querySelector('.title-section h1');
    const navMenu = document.querySelector('.title-section nav.menu');
    const twoColumnLayout = document.querySelector('.two-column-layout');
    const profileImg = document.querySelector('.profile-image-absolute');
    const aboutSection = document.querySelector('.about-section');
    const highlightsSection = document.querySelector('.highlights-section');

    // --- Prepare Nav Links for Typewriter ---
    const navLinks = navMenu ? Array.from(navMenu.querySelectorAll('.nav-link-text')) : [];
    const linkData = navLinks.map(link => {
        const text = link.getAttribute('data-text');
        link.textContent = ''; // Clear initial text
        return { element: link, text: text, currentLength: 0 };
    });
    let totalChars = linkData.reduce((sum, link) => sum + link.text.length, 0);
    let typedChars = 0;
    let currentLinkIndex = 0;
    const typingSpeed = 40; // Milliseconds per character

    // Ensure elements exist before proceeding
    if (!homeContainer || !titleSection || !titleH1 || !navMenu || !twoColumnLayout || !profileImg || !aboutSection || !highlightsSection) {
        console.error("Animation elements not found!");
        // Fallback: Make everything visible immediately
        if(titleH1) titleH1.classList.add('visible');
        if(navMenu) {
            navMenu.classList.add('visible');
            // Restore text if fallback
            linkData.forEach(data => data.element.textContent = data.text);
        }
        if(profileImg) profileImg.classList.add('visible');
        if(aboutSection) aboutSection.classList.add('visible');
        if(highlightsSection) highlightsSection.classList.add('visible');
        if(twoColumnLayout) twoColumnLayout.classList.add('visible');
        if(homeContainer) homeContainer.classList.add('layout-final');
        if(titleSection) titleSection.classList.add('move-to-top');
        return;
    }

    // --- Typewriter Function ---
    function typeCharacter() {
        if (currentLinkIndex < linkData.length) {
            const currentData = linkData[currentLinkIndex];
            if (currentData.currentLength < currentData.text.length) {
                // Add next character
                currentData.element.textContent += currentData.text[currentData.currentLength];
                currentData.currentLength++;
                typedChars++;
                // Schedule next character
                setTimeout(typeCharacter, typingSpeed);
            } else {
                // Move to next link
                currentLinkIndex++;
                // Add a slight pause between links if desired
                // setTimeout(typeCharacter, typingSpeed * 2);
                // Or continue immediately:
                typeCharacter();
            }
        }
    }

    // --- Animation Sequence ---

    // 1. Fade in Title & Start Move Up
    setTimeout(() => {
        titleH1.classList.add('visible');
        titleSection.classList.add('move-to-top');
        homeContainer.classList.add('layout-final');
    }, 100);

    // 2. Start Nav Menu Animation & Trigger Typewriter
    setTimeout(() => {
        navMenu.classList.add('visible'); // Start container fade-in/move-up
        typeCharacter(); // Start typing effect
    }, 300);

    // 3. Adjust Layout Margin
    setTimeout(() => {
        twoColumnLayout.classList.add('visible');
    }, 1000);

    // 4. Start Fade in Image, About, and Highlights Sections
    setTimeout(() => {
        profileImg.classList.add('visible');
        aboutSection.classList.add('visible');
        highlightsSection.classList.add('visible');
    }, 1600);


    // --- Image Click Handler (Keep existing logic) ---
    if (profileImg) {
        profileImg.addEventListener('click', function() {
          // Restore the modal creation code:
          const modal = document.createElement('div');
          modal.style.position = 'fixed';
          modal.style.top = '0';
          modal.style.left = '0';
          modal.style.width = '100%';
          modal.style.height = '100%';
          modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
          modal.style.display = 'flex';
          modal.style.justifyContent = 'center';
          modal.style.alignItems = 'center';
          modal.style.zIndex = '1000'; // Ensure modal is on top
          modal.style.cursor = 'pointer';

          const largeImg = document.createElement('img');
          largeImg.src = '/img/artin_headshot_full.jpg';
          largeImg.style.maxHeight = '90vh';
          largeImg.style.maxWidth = '90vw';
          largeImg.style.borderRadius = '0.5rem';
          largeImg.style.cursor = 'default';

          largeImg.addEventListener('click', function(event) {
            event.stopPropagation();
          });

          modal.addEventListener('click', function() {
            document.body.removeChild(modal);
          });

          modal.appendChild(largeImg);
          document.body.appendChild(modal);
        });
    }
  });
</script>
{{ end }}